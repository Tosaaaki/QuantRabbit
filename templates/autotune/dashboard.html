{% extends "base.html" %}
{% block content %}
  <div class="tabs" data-tabs>
    <div class="tabs-bar" role="tablist" aria-label="Dashboard sections">
      <button
        type="button"
        class="tab-button is-active"
        role="tab"
        id="tab-summary-button"
        aria-selected="true"
        aria-controls="tab-summary"
        data-tab-button
        data-tab-target="summary"
      >サマリー</button>
      <button
        type="button"
        class="tab-button"
        role="tab"
        id="tab-ops-button"
        aria-selected="false"
        aria-controls="tab-ops"
        data-tab-button
        data-tab-target="ops"
        tabindex="-1"
      >オペレーション</button>
      <button
        type="button"
        class="tab-button"
        role="tab"
        id="tab-history-button"
        aria-selected="false"
        aria-controls="tab-history"
        data-tab-button
        data-tab-target="history"
        tabindex="-1"
      >履歴</button>
    </div>
    <div class="tab-meta">セクションを切り替えて表示できます。</div>

    <section class="tab-panel is-active" id="tab-summary" role="tabpanel" aria-labelledby="tab-summary-button" data-tab-panel="summary">
      <div class="card">
    <h2>運用サマリー</h2>
    {% if dashboard.available %}
      {% if dashboard.generated_label %}
        <p class="stat-sub">最終更新: {{ dashboard.generated_label }}</p>
      {% endif %}
    {% else %}
      <p class="stat-sub warning">
        リアルタイムスナップショットを取得できませんでした{% if dashboard.error %}: {{ dashboard.error }}{% endif %}。
        GCS の設定と `run_sync_pipeline.py` の動作を確認してください。
      </p>
    {% endif %}
    <div class="refresh-row" data-auto-refresh data-auto-refresh-sec="{{ dashboard.auto_refresh_sec }}">
      <div class="refresh-meta">
        <span class="refresh-dot" aria-hidden="true"></span>
        <span class="refresh-text">自動更新 {{ dashboard.auto_refresh_sec }}s</span>
        <span class="refresh-status" data-refresh-status></span>
      </div>
      <div class="refresh-actions">
        <button type="button" class="btn-ghost" data-refresh-now>更新</button>
      </div>
    </div>
    <div class="stats-grid">
      {% set daily_class = 'stat-positive' if dashboard.performance.daily_pl_pips >= 0 else 'stat-negative' %}
      <div class="stat-card">
        <div class="stat-label">日次損益（JST）</div>
        <div class="stat-value {{ daily_class }}">{{ "%+.1f"|format(dashboard.performance.daily_pl_pips) }}p</div>
        <div class="stat-sub">{{ "%+.0f"|format(dashboard.performance.daily_pl_jpy) }} 円</div>
        <div class="stat-sub">1L eq {{ "%+.1f"|format(dashboard.performance.daily_pl_eq1l) }}p</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">前日比（口座比）</div>
        {% if dashboard.performance.daily_change_pct is not none %}
          {% set change_class = 'stat-positive' if dashboard.performance.daily_change_pct >= 0 else 'stat-negative' %}
          <div class="stat-value {{ change_class }}">{{ "%+.1f"|format(dashboard.performance.daily_change_pct) }}%</div>
        {% else %}
          <div class="stat-value">-</div>
        {% endif %}
        <div class="stat-sub">差分 {{ "%+.0f"|format(dashboard.performance.daily_change_jpy) }} 円</div>
        {% if dashboard.performance.daily_change_equity %}
          {% if dashboard.performance.daily_change_equity_source == "balance" %}
            <div class="stat-sub">基準Balance {{ "%.0f"|format(dashboard.performance.daily_change_equity) }} 円</div>
          {% else %}
            <div class="stat-sub">基準NAV {{ "%.0f"|format(dashboard.performance.daily_change_equity) }} 円</div>
          {% endif %}
        {% else %}
          <div class="stat-sub">基準NAV -</div>
        {% endif %}
      </div>
      {% set weekly_class = 'stat-positive' if dashboard.performance.weekly_pl_pips >= 0 else 'stat-negative' %}
      <div class="stat-card">
        <div class="stat-label">週次損益（JST）</div>
        <div class="stat-value {{ weekly_class }}">{{ "%+.1f"|format(dashboard.performance.weekly_pl_pips) }}p</div>
        <div class="stat-sub">{{ "%+.0f"|format(dashboard.performance.weekly_pl_jpy) }} 円</div>
        <div class="stat-sub">1L eq {{ "%+.1f"|format(dashboard.performance.weekly_pl_eq1l) }}p</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">年初残高比（手動除外）</div>
        {% if dashboard.ytd_summary.bot_return_pct is not none %}
          {% set ytd_class = 'stat-positive' if dashboard.ytd_summary.bot_return_pct >= 0 else 'stat-negative' %}
          <div class="stat-value {{ ytd_class }}">{{ "%+.2f"|format(dashboard.ytd_summary.bot_return_pct) }}%</div>
        {% else %}
          <div class="stat-value">-</div>
        {% endif %}
        <div class="stat-sub">YTD {{ "%+.0f"|format(dashboard.ytd_summary.bot_profit_jpy) }} 円</div>
        {% if dashboard.ytd_summary.start_balance %}
          {% if dashboard.ytd_summary.start_balance_source == "metric" %}
            <div class="stat-sub">開始残高 {{ "%.0f"|format(dashboard.ytd_summary.start_balance) }} 円</div>
          {% else %}
            <div class="stat-sub">開始残高 -</div>
          {% endif %}
        {% else %}
          <div class="stat-sub">開始残高 -</div>
        {% endif %}
      </div>
      <div class="stat-card">
        <div class="stat-label">勝率</div>
        {% if dashboard.performance.recent_closed %}
          <div class="stat-value">{{ "%.1f"|format(dashboard.performance.win_rate_percent) }}%</div>
          <div class="stat-sub">{{ dashboard.performance.wins }} 勝 / {{ dashboard.performance.losses }} 敗</div>
        {% else %}
          <div class="stat-value">-</div>
          <div class="stat-sub">十分な検証データがありません</div>
        {% endif %}
      </div>
      <div class="stat-card">
        <div class="stat-label">決済件数 (7d)</div>
        <div class="stat-value">{{ dashboard.performance.recent_closed }}</div>
        <div class="stat-sub">累積 {{ dashboard.performance.total_trades }} 件</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">保有ポジション</div>
        <div class="stat-value">{{ dashboard.performance.open_positions }}</div>
        <div class="stat-sub">ネット units {{ "%+.0f"|format(dashboard.performance.net_units) }}</div>
        <div class="stat-sub">未実現 {{ "%+.1f"|format(dashboard.performance.unrealized_pl_pips) }}p / {{ "%+.0f"|format(dashboard.performance.unrealized_pl_jpy) }} 円（上段は確定損益）</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">新規トレード</div>
        <div class="stat-value">{{ dashboard.performance.new_trades }}</div>
        <div class="stat-sub">最終トレード {{ dashboard.performance.last_trade_at or '-' }}</div>
      </div>
    </div>

    {% if dashboard.performance.pockets %}
      <div class="section-title">Pocket成績（累積）</div>
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>Pocket</th>
              <th>損益 (pips)</th>
              <th>損益 (JPY)</th>
              <th>件数</th>
              <th>勝率</th>
              <th>PF</th>
            </tr>
          </thead>
          <tbody>
          {% for row in dashboard.performance.pockets %}
            {% set pill_class = 'pill gain' if row.pips > 0 else 'pill loss' if row.pips < 0 else 'pill neutral' %}
            <tr>
              <td>{{ row.pocket }}</td>
              <td><span class="{{ pill_class }}">{{ "%+.1f"|format(row.pips) }}</span></td>
              <td>{{ "%+.0f"|format(row.jpy) }}</td>
              <td>{{ row.trades }}</td>
              <td>
                {% if row.win_rate is not none %}
                  {{ "%.1f"|format(row.win_rate) }}%
                {% else %}
                  -
                {% endif %}
              </td>
              <td>
                {% if row.pf is not none %}
                  {{ "%.2f"|format(row.pf) }}
                {% else %}
                  -
                {% endif %}
              </td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    {% endif %}

    {% if dashboard.profit_tables and dashboard.profit_tables.daily %}
      <div class="section-title">利益表（{{ dashboard.profit_tables.year_start }}〜 / {{ dashboard.profit_tables.timezone }} / 手動除外）</div>

      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>日次</th>
              <th>損益 (pips)</th>
              <th>損益 (JPY)</th>
              <th>開始残高</th>
              <th>残高比</th>
              <th>件数</th>
              <th>勝率</th>
            </tr>
          </thead>
          <tbody>
            {% for row in dashboard.profit_tables.daily %}
              {% set pill_class = 'pill gain' if row.pips > 0 else 'pill loss' if row.pips < 0 else 'pill neutral' %}
              <tr>
                <td>{{ row.label }}</td>
                <td><span class="{{ pill_class }}">{{ "%+.1f"|format(row.pips) }}</span></td>
                <td>{{ "%+.0f"|format(row.jpy) }}</td>
                <td>{% if row.start_balance %}{{ "%.0f"|format(row.start_balance) }}{% else %}-{% endif %}</td>
                <td>{% if row.return_pct is not none %}{{ "%+.2f"|format(row.return_pct) }}%{% else %}-{% endif %}</td>
                <td>{{ row.trades }}</td>
                <td>{{ "%.1f"|format(row.win_rate * 100.0) }}%</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>週次</th>
              <th>損益 (pips)</th>
              <th>損益 (JPY)</th>
              <th>開始残高</th>
              <th>残高比</th>
              <th>件数</th>
              <th>勝率</th>
            </tr>
          </thead>
          <tbody>
            {% for row in dashboard.profit_tables.weekly %}
              {% set pill_class = 'pill gain' if row.pips > 0 else 'pill loss' if row.pips < 0 else 'pill neutral' %}
              <tr>
                <td>{{ row.label }}</td>
                <td><span class="{{ pill_class }}">{{ "%+.1f"|format(row.pips) }}</span></td>
                <td>{{ "%+.0f"|format(row.jpy) }}</td>
                <td>{% if row.start_balance %}{{ "%.0f"|format(row.start_balance) }}{% else %}-{% endif %}</td>
                <td>{% if row.return_pct is not none %}{{ "%+.2f"|format(row.return_pct) }}%{% else %}-{% endif %}</td>
                <td>{{ row.trades }}</td>
                <td>{{ "%.1f"|format(row.win_rate * 100.0) }}%</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>月次</th>
              <th>損益 (pips)</th>
              <th>損益 (JPY)</th>
              <th>開始残高</th>
              <th>残高比</th>
              <th>件数</th>
              <th>勝率</th>
            </tr>
          </thead>
          <tbody>
            {% for row in dashboard.profit_tables.monthly %}
              {% set pill_class = 'pill gain' if row.pips > 0 else 'pill loss' if row.pips < 0 else 'pill neutral' %}
              <tr>
                <td>{{ row.label }}</td>
                <td><span class="{{ pill_class }}">{{ "%+.1f"|format(row.pips) }}</span></td>
                <td>{{ "%+.0f"|format(row.jpy) }}</td>
                <td>{% if row.start_balance %}{{ "%.0f"|format(row.start_balance) }}{% else %}-{% endif %}</td>
                <td>{% if row.return_pct is not none %}{{ "%+.2f"|format(row.return_pct) }}%{% else %}-{% endif %}</td>
                <td>{{ row.trades }}</td>
                <td>{{ "%.1f"|format(row.win_rate * 100.0) }}%</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% endif %}
  </div>

      <div class="card">
        <h2>オープンポジション</h2>
        <div class="tagline">
          合計 {{ dashboard.open_summary.total_positions }} 件 /
          ネット units {{ "%+.0f"|format(dashboard.open_summary.net_units) }} /
          未実現 {{ "%+.1f"|format(dashboard.open_summary.unrealized_pl_pips) }}p / {{ "%+.0f"|format(dashboard.open_summary.unrealized_pl_jpy) }} 円
        </div>
        {% if dashboard.open_summary.pockets %}
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>Pocket</th>
                  <th>方向</th>
                  <th>数量</th>
                  <th>平均価格</th>
                  <th>未実現 (pips)</th>
                  <th>未実現 (JPY)</th>
                  <th>建玉数</th>
                </tr>
              </thead>
              <tbody>
              {% for row in dashboard.open_summary.pockets %}
                {% set pill_class = 'pill gain' if row.unrealized_pips > 0 else 'pill loss' if row.unrealized_pips < 0 else 'pill neutral' %}
                <tr>
                  <td>{{ row.pocket }}</td>
                  <td>{{ row.direction }}</td>
                  <td>{{ "{:,}".format(row.units_abs) }}</td>
                  <td>{{ "%.3f"|format(row.avg_price) }}</td>
                  <td><span class="{{ pill_class }}">{{ "%+.2f"|format(row.unrealized_pips) }}p</span></td>
                  <td>{{ "%+.0f"|format(row.unrealized_jpy) }}</td>
                  <td>{{ row.trades }}</td>
                </tr>
              {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <p class="tagline">現在オープンポジションはありません。</p>
        {% endif %}
      </div>
    </section>

    <section class="tab-panel" id="tab-ops" role="tabpanel" aria-labelledby="tab-ops-button" data-tab-panel="ops">
      <div class="card">
        <h2>システムヘルス</h2>
    <div class="tagline">データ遅延・判断遅延・ヘルスビート・シグナルの最新状況をまとめています。</div>
    <div class="stats-grid">
      <div class="stat-card compact">
        <div class="stat-label">データ遅延</div>
        <div class="stat-value {{ dashboard.system.data_lag_level }}">
          {% if dashboard.system.data_lag_ms is not none %}
            {{ "%.0f"|format(dashboard.system.data_lag_ms) }}ms
          {% else %}
            -
          {% endif %}
        </div>
        <div class="stat-sub">SLO 1500ms</div>
      </div>
      <div class="stat-card compact">
        <div class="stat-label">判断遅延</div>
        <div class="stat-value {{ dashboard.system.decision_latency_level }}">
          {% if dashboard.system.decision_latency_ms is not none %}
            {{ "%.0f"|format(dashboard.system.decision_latency_ms) }}ms
          {% else %}
            -
          {% endif %}
        </div>
        <div class="stat-sub">SLO 2000ms</div>
      </div>
      <div class="stat-card compact">
        <div class="stat-label">ヘルスビート</div>
        <div class="stat-value {{ dashboard.system.healthbeat_level }}">
          {% if dashboard.system.healthbeat_age_min is not none %}
            {{ dashboard.system.healthbeat_age_min }}分前
          {% else %}
            -
          {% endif %}
        </div>
        <div class="stat-sub">最終 {{ dashboard.system.healthbeat_label or '-' }}</div>
      </div>
      <div class="stat-card compact">
        <div class="stat-label">最終シグナル</div>
        <div class="stat-value {{ dashboard.system.signals_last_level }}">
          {% if dashboard.system.signals_last_age_min is not none %}
            {{ dashboard.system.signals_last_age_min }}分前
          {% else %}
            -
          {% endif %}
        </div>
        <div class="stat-sub">最終 {{ dashboard.system.signals_last_label or '-' }}</div>
      </div>
      <div class="stat-card compact">
        <div class="stat-label">注文 (1h)</div>
        <div class="stat-value">
          {% if dashboard.system.orders_total_1h is not none %}
            {{ dashboard.system.orders_total_1h }}
          {% else %}
            -
          {% endif %}
        </div>
        <div class="stat-sub">ステータス集計</div>
      </div>
    </div>

    <div class="section-title">注文ステータス（直近1時間）</div>
    {% if dashboard.system.orders_status_1h %}
      <div class="pill-row">
        {% for row in dashboard.system.orders_status_1h %}
          <span class="pill {{ row.level }}">{{ row.status }} {{ row.count }}</span>
        {% endfor %}
      </div>
    {% else %}
      <p class="tagline">直近1時間の注文データがありません。</p>
    {% endif %}

    <div class="section-title">最近のシグナル / 注文</div>
    <div class="split-equal">
      <div>
        <div class="section-subtitle">最近のシグナル</div>
        {% if dashboard.system.signals_recent %}
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>時刻</th>
                  <th>Pocket</th>
                  <th>戦略</th>
                  <th>アクション</th>
                  <th>信頼度</th>
                  <th>Units</th>
                  <th>ID</th>
                </tr>
              </thead>
              <tbody>
              {% for row in dashboard.system.signals_recent %}
                <tr>
                  <td class="mono nowrap">{{ row.ts_label }}</td>
                  <td>{{ row.pocket }}</td>
                  <td>{{ row.strategy }}</td>
                  <td>{{ row.action }}</td>
                  <td>{{ row.confidence if row.confidence is not none else '-' }}</td>
                  <td>{{ row.units if row.units is not none else '-' }}</td>
                  <td class="mono"><span title="{{ row.id_full }}">{{ row.id_short }}</span></td>
                </tr>
              {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <p class="tagline">シグナルの直近履歴がありません。</p>
        {% endif %}
      </div>
      <div>
        <div class="section-subtitle">最近の注文</div>
        {% if dashboard.system.orders_last %}
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>時刻</th>
                  <th>Pocket</th>
                  <th>方向</th>
                  <th>Units</th>
                  <th>状態</th>
                  <th>ID</th>
                </tr>
              </thead>
              <tbody>
              {% for row in dashboard.system.orders_last %}
                <tr>
                  <td class="mono nowrap">{{ row.ts_label }}</td>
                  <td>{{ row.pocket }}</td>
                  <td>{{ row.side }}</td>
                  <td>{{ row.units if row.units is not none else '-' }}</td>
                  <td class="{{ row.status_level }}">{{ row.status }}</td>
                  <td class="mono"><span title="{{ row.id_full }}">{{ row.id_short }}</span></td>
                </tr>
              {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <p class="tagline">注文の直近履歴がありません。</p>
        {% endif %}
      </div>
    </div>
  </div>

      <div class="card">
        <h2>緊急操作</h2>
        <div class="tagline">
          取引ワーカーを一括で停止/再開します。実行には Ops トークンが必要です。
        </div>
        {% if ops_notice %}
          <p class="tagline">{{ ops_notice }}</p>
        {% endif %}
        {% if ops_error %}
          <p class="tagline warning">{{ ops_error }}</p>
        {% endif %}
        {% if ops_enabled %}
          <div class="split-equal">
            <form method="post" action="/ops/control" class="form-block">
              <input type="hidden" name="action" value="stop">
              <div class="field-grid">
                <label class="field-label" for="ops-stop-confirm">確認テキスト</label>
                <input id="ops-stop-confirm" name="confirm" class="input-compact" placeholder="STOP" autocomplete="off" required>
                <label class="field-label" for="ops-stop-token">Ops トークン</label>
                <input id="ops-stop-token" name="ops_token" type="password" class="input-compact" placeholder="ui_ops_token" required>
              </div>
              <div class="buttons" style="margin-top:0.8rem;">
                <button type="submit" class="danger">緊急停止</button>
              </div>
            </form>
            <form method="post" action="/ops/control" class="form-block">
              <input type="hidden" name="action" value="start">
              <div class="field-grid">
                <label class="field-label" for="ops-start-confirm">確認テキスト</label>
                <input id="ops-start-confirm" name="confirm" class="input-compact" placeholder="START" autocomplete="off" required>
                <label class="field-label" for="ops-start-token">Ops トークン</label>
                <input id="ops-start-token" name="ops_token" type="password" class="input-compact" placeholder="ui_ops_token" required>
              </div>
              <div class="buttons" style="margin-top:0.8rem;">
                <button type="submit" class="success">再開</button>
              </div>
            </form>
          </div>
        {% else %}
          <p class="tagline warning">ui_ops_token が未設定のため操作できません。</p>
        {% endif %}
      </div>
    </section>

    <section class="tab-panel" id="tab-history" role="tabpanel" aria-labelledby="tab-history-button" data-tab-panel="history">
      <div class="card">
        <h2>最近のトレード</h2>
    <div class="tagline">更新順で最新12件を表示します。状態/決済理由も併記します。</div>
    {% if dashboard.recent_trades %}
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>更新</th>
              <th>Pocket</th>
              <th>Worker</th>
              <th>方向</th>
              <th>数量</th>
              <th>Entry</th>
              <th>Close</th>
              <th>損益 (pips)</th>
              <th>損益 (JPY)</th>
              <th>状態</th>
              <th>決済理由</th>
            </tr>
          </thead>
          <tbody>
          {% for row in dashboard.recent_trades %}
            {% set pill_class = 'pill gain' if row.kind == 'gain' else 'pill loss' if row.kind == 'loss' else 'pill neutral' %}
            <tr>
              <td class="mono nowrap">{{ row.updated_label }}</td>
              <td>{{ row.pocket }}</td>
              <td class="mono nowrap">{{ row.worker }}</td>
              <td>{{ row.direction }}</td>
              <td>{{ "{:,}".format(row.units_abs) }}</td>
              <td>
                {% if row.entry_price is not none %}
                  {{ "%.3f"|format(row.entry_price) }}
                {% else %}
                  -
                {% endif %}
              </td>
              <td>
                {% if row.close_price is not none %}
                  {{ "%.3f"|format(row.close_price) }}
                {% else %}
                  -
                {% endif %}
              </td>
              <td><span class="{{ pill_class }}">{{ "%+.1f"|format(row.pl_pips) }}</span></td>
              <td>{{ "%+.0f"|format(row.pl_jpy) }}</td>
              <td>{{ row.state }}</td>
              <td>{{ row.close_reason }}</td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p class="tagline">トレード履歴がありません。</p>
    {% endif %}
  </div>

  <div class="card">
    <h2>トレードハイライト</h2>
    <div class="split-equal">
      <div>
        <div class="section-subtitle">トップ勝ち／負け</div>
        {% if dashboard.highlights_top %}
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>チケット</th>
                  <th>Pocket</th>
                  <th>損益 (pips)</th>
                  <th>損益 (JPY)</th>
                  <th>決済時刻</th>
                </tr>
              </thead>
              <tbody>
              {% for row in dashboard.highlights_top %}
                {% set pill_class = 'pill gain' if row.kind == 'gain' else 'pill loss' %}
                <tr>
                  <td>{{ row.ticket_id }}</td>
                  <td>{{ row.pocket }}</td>
                  <td><span class="{{ pill_class }}">{{ "%+.1f"|format(row.pl_pips) }}</span></td>
                  <td>{{ "%+.0f"|format(row.pl_jpy) }}</td>
                  <td>{{ row.closed_at or '-' }}</td>
                </tr>
              {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <p class="tagline">十分なトレード実績がありません。</p>
        {% endif %}
      </div>
      <div>
        <div class="section-subtitle">最新トレード</div>
        {% if dashboard.highlights_recent %}
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>チケット</th>
                  <th>Pocket</th>
                  <th>損益 (pips)</th>
                  <th>損益 (JPY)</th>
                  <th>決済時刻</th>
                </tr>
              </thead>
              <tbody>
              {% for row in dashboard.highlights_recent %}
                {% set pill_class = 'pill gain' if row.kind == 'gain' else 'pill loss' if row.kind == 'loss' else 'pill neutral' %}
                <tr>
                  <td>{{ row.ticket_id }}</td>
                  <td>{{ row.pocket }}</td>
                  <td><span class="{{ pill_class }}">{{ "%+.1f"|format(row.pl_pips) }}</span></td>
                  <td>{{ "%+.0f"|format(row.pl_jpy) }}</td>
                  <td>{{ row.closed_at or '-' }}</td>
                </tr>
              {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <p class="tagline">最新トレード情報がまだありません。</p>
        {% endif %}
      </div>
    </div>
  </div>
    </section>
  </div>
{% endblock %}

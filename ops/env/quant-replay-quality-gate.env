# Replay quality gate worker defaults.
# Paths are relative to /home/tossaki/QuantRabbit unless absolute.

REPLAY_QUALITY_GATE_CONFIG=config/replay_quality_gate_main.yaml
REPLAY_QUALITY_GATE_OUT_DIR=tmp/replay_quality_gate
REPLAY_QUALITY_GATE_STATE_PATH=logs/replay_quality_gate_latest.json
REPLAY_QUALITY_GATE_HISTORY_PATH=logs/replay_quality_gate_history.jsonl
REPLAY_QUALITY_GATE_TIMEOUT_SEC=1800
REPLAY_QUALITY_GATE_KEEP_RUNS=24
REPLAY_QUALITY_GATE_STRICT=0
# Live trading VM default: keep replay QA running hourly with low-priority systemd settings.
REPLAY_QUALITY_GATE_ENABLED=1
# Skip heavy replay workloads while market is open; run during closed window.
REPLAY_QUALITY_GATE_SKIP_WHEN_MARKET_OPEN=1

# Optional runtime overrides:
# REPLAY_QUALITY_GATE_TICKS_GLOB=logs/replay/USD_JPY/USD_JPY_ticks_202602*.jsonl
# REPLAY_QUALITY_GATE_WORKERS=session_open
# REPLAY_QUALITY_GATE_BACKEND=exit_workers_groups

# Replay -> Analysis auto-improve bridge.
# 1) replay quality gate run
# 2) trade_counterfactual (replay input) per target strategy
# 3) apply reentry_overrides (cooldown/reentry-distance/bias) to config/worker_reentry.yaml
#    block_jst_hours はデフォルトでは自動適用しない
REPLAY_QUALITY_GATE_AUTO_IMPROVE_ENABLED=1
REPLAY_QUALITY_GATE_AUTO_IMPROVE_SCOPE=failing
REPLAY_QUALITY_GATE_AUTO_IMPROVE_INCLUDE_LIVE_TRADES=0
REPLAY_QUALITY_GATE_AUTO_IMPROVE_MIN_TRADES=24
REPLAY_QUALITY_GATE_AUTO_IMPROVE_MAX_BLOCK_HOURS=8
REPLAY_QUALITY_GATE_AUTO_IMPROVE_APPLY_BLOCK_HOURS=0
REPLAY_QUALITY_GATE_AUTO_IMPROVE_MIN_REENTRY_CONFIDENCE=0.70
REPLAY_QUALITY_GATE_AUTO_IMPROVE_MIN_REENTRY_LCB_UPLIFT_PIPS=0.20
REPLAY_QUALITY_GATE_AUTO_IMPROVE_MIN_APPLY_INTERVAL_SEC=10800
REPLAY_QUALITY_GATE_AUTO_IMPROVE_APPLY_REENTRY=1
REPLAY_QUALITY_GATE_AUTO_IMPROVE_COUNTERFACTUAL_TIMEOUT_SEC=600
REPLAY_QUALITY_GATE_AUTO_IMPROVE_COUNTERFACTUAL_OUT_DIR=logs/replay_auto_improve
REPLAY_QUALITY_GATE_AUTO_IMPROVE_APPLY_STATE_PATH=logs/replay_auto_improve_state.json
REPLAY_QUALITY_GATE_AUTO_IMPROVE_REENTRY_CONFIG_PATH=config/worker_reentry.yaml
# Optional: force replay json sources and/or strategy targets
# REPLAY_QUALITY_GATE_AUTO_IMPROVE_REPLAY_JSON_GLOBS=tmp/replay_quality_gate/*/runs/*/replay_exit_workers.json,tmp/replay_quality_gate/*/runs/*/replay_exit_*_base.json
# REPLAY_QUALITY_GATE_AUTO_IMPROVE_STRATEGIES=scalp_ping_5s_b_live,session_open

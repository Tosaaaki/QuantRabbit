# Aggressive VM overrides: increase entry frequency and sizing.

# --- Entry frequency: remove policy gating / narrow allowlists ---
ORDER_POLICY_GATE_ENABLED=0
SIGNAL_GATE_POLICY_ENABLED=0
POLICY_BQ_INSIGHTS_ENABLED=0
ORDER_ENTRY_QUALITY_GATE_ENABLED=0
ORDER_ENTRY_QUALITY_MICROSTRUCTURE_ENABLED=0
ENTRY_FACTOR_STALE_ALLOW_POCKETS=scalp

PERF_GUARD_GLOBAL_ENABLED=1
PERF_GUARD_ENABLED=1
PERF_GUARD_RELAX_TAGS=TickImbalance
PERF_GUARD_SETUP_ENABLED=1
PERF_GUARD_SETUP_USE_HOUR=1
PERF_GUARD_SETUP_USE_DIRECTION=1
PERF_GUARD_SETUP_USE_REGIME=1
PERF_GUARD_SETUP_MIN_TRADES=12
PERF_GUARD_SETUP_PF_MIN=1.02
PERF_GUARD_SETUP_WIN_MIN=0.53
PERF_GUARD_SETUP_AVG_PIPS_MIN=0.00
# Individual setup guard (5秒スキャ除外) - block only underperforming tags quickly.
PERF_GUARD_SETUP_MIN_TRADES_STRATEGY_M1SCALPER_SELL_RALLY=6
PERF_GUARD_SETUP_PF_MIN_STRATEGY_M1SCALPER_SELL_RALLY=1.25
PERF_GUARD_SETUP_WIN_MIN_STRATEGY_M1SCALPER_SELL_RALLY=0.60
PERF_GUARD_SETUP_AVG_PIPS_MIN_STRATEGY_M1SCALPER_SELL_RALLY=0.20
PERF_GUARD_SETUP_MIN_TRADES_STRATEGY_M1SCALPER_BUY_DIP=6
PERF_GUARD_SETUP_PF_MIN_STRATEGY_M1SCALPER_BUY_DIP=1.08
PERF_GUARD_SETUP_WIN_MIN_STRATEGY_M1SCALPER_BUY_DIP=0.55
PERF_GUARD_SETUP_AVG_PIPS_MIN_STRATEGY_M1SCALPER_BUY_DIP=0.05
PERF_GUARD_SETUP_MIN_TRADES_STRATEGY_SQUEEZEPULSEBREAK=8
PERF_GUARD_SETUP_PF_MIN_STRATEGY_SQUEEZEPULSEBREAK=1.12
PERF_GUARD_SETUP_WIN_MIN_STRATEGY_SQUEEZEPULSEBREAK=0.58
PERF_GUARD_SETUP_AVG_PIPS_MIN_STRATEGY_SQUEEZEPULSEBREAK=0.08
PERF_GUARD_SETUP_MIN_TRADES_STRATEGY_WICKREVERSALHF=8
PERF_GUARD_SETUP_PF_MIN_STRATEGY_WICKREVERSALHF=1.10
PERF_GUARD_SETUP_WIN_MIN_STRATEGY_WICKREVERSALHF=0.58
PERF_GUARD_SETUP_AVG_PIPS_MIN_STRATEGY_WICKREVERSALHF=0.08
PERF_GUARD_SETUP_MIN_TRADES_STRATEGY_MICROCOMPRESSIONREVERT_SHORT=6
PERF_GUARD_SETUP_PF_MIN_STRATEGY_MICROCOMPRESSIONREVERT_SHORT=1.15
PERF_GUARD_SETUP_WIN_MIN_STRATEGY_MICROCOMPRESSIONREVERT_SHORT=0.56
PERF_GUARD_SETUP_AVG_PIPS_MIN_STRATEGY_MICROCOMPRESSIONREVERT_SHORT=0.10
# Individual base guard (fallback when setup bucket has low samples).
PERF_GUARD_MIN_TRADES_STRATEGY_TICKIMBALANCE=20
PERF_GUARD_PF_MIN_STRATEGY_TICKIMBALANCE=1.10
PERF_GUARD_WIN_MIN_STRATEGY_TICKIMBALANCE=0.56
PERF_GUARD_MIN_TRADES_STRATEGY_M1SCALPER_SELL_RALLY=6
PERF_GUARD_PF_MIN_STRATEGY_M1SCALPER_SELL_RALLY=1.15
PERF_GUARD_WIN_MIN_STRATEGY_M1SCALPER_SELL_RALLY=0.56
PERF_GUARD_MIN_TRADES_STRATEGY_M1SCALPER_BUY_DIP=6
PERF_GUARD_PF_MIN_STRATEGY_M1SCALPER_BUY_DIP=1.05
PERF_GUARD_WIN_MIN_STRATEGY_M1SCALPER_BUY_DIP=0.53
PERF_GUARD_MIN_TRADES_STRATEGY_SQUEEZEPULSEBREAK=8
PERF_GUARD_PF_MIN_STRATEGY_SQUEEZEPULSEBREAK=1.08
PERF_GUARD_WIN_MIN_STRATEGY_SQUEEZEPULSEBREAK=0.54
PERF_GUARD_MIN_TRADES_STRATEGY_MICROCOMPRESSIONREVERT_SHORT=6
PERF_GUARD_PF_MIN_STRATEGY_MICROCOMPRESSIONREVERT_SHORT=1.10
PERF_GUARD_WIN_MIN_STRATEGY_MICROCOMPRESSIONREVERT_SHORT=0.55
MICRO_MULTI_ENABLED=1
FORECAST_GATE_ENABLED=0
HEDGE_BALANCER_ENABLED=0

SIGNAL_GATE_POCKET_ALLOWLIST=micro,scalp,macro
SIGNAL_GATE_STRATEGY_ALLOWLIST=TrendMAbu,Donchian5,LevelReject,MicroCompressionRevert,MicroRangeBreak,MicroPullbackEMA,MicroVWAPRevert,MomentumPulse,impulse_retest_s5

MICRO_STRATEGY_ALLOWLIST=MicroLevelReactor,MicroRangeBreak,MicroVWAPRevert,MicroPullbackEMA,MicroCompressionRevert,MomentumPulse,MomentumBurst,MicroVWAPBound

# --- Position sizing: increase risk/lot ceilings and base units ---
risk_pct=0.04
RISK_MAX_LOT=24.0
GROSS_EXPOSURE_HARD=48.0
MAX_MARGIN_USAGE=0.90
MAX_MARGIN_USAGE_HARD=0.92
TARGET_MARGIN_USAGE=0.88
MIN_FREE_MARGIN_RATIO=0.03
FREE_MARGIN_SOFT_RATIO=0.14
FREE_MARGIN_HARD_RATIO=0.10

POCKET_MAX_RATIO_MICRO=0.95
POCKET_MAX_RATIO_MACRO=0.95
POCKET_MAX_RATIO_SCALP=0.95
POCKET_MAX_RATIO_SCALP_FAST=0.95

# Dynamic sizing caps (used by some S5 workers)
DYN_SIZE_BASE_RISK_PCT=0.015
DYN_SIZE_MIN_RISK_PCT=0.003
DYN_SIZE_MAX_RISK_PCT=0.05
DYN_CAP_RANGE_CAP=0.72
DYN_CAP_PF_BOOST_MIN=1.20
DYN_CAP_PF_BOOST_MULT=1.20
DYN_CAP_PF_CUT_MAX=0.80
DYN_CAP_PF_CUT_MULT=0.92

# Macro base sizes were heavily suppressed on the VM; restore aggressive defaults
TRENDMA_BASE_UNITS=70000
TRENDMA_DYN_CAP_RANGE_CAP=0.85
H1M_BASE_UNITS=60000

# Scalp base sizes
M1SCALP_ENABLED=1
M1SCALP_BASE_UNITS=15000
M1SCALP_MAX_OPEN_TRADES=1
M1SCALP_COOLDOWN_SEC=12
M1SCALP_HTF_BLOCK_COUNTER=1
M1SCALP_ENV_TICK_GAP_MS_LIMIT=2500
M1SCALP_ENV_TICK_GAP_MOVE_PIPS=1.6
M1SCALP_ENV_INSTANT_MOVE_LIMIT=3.5
M1SCALP_DYN_CAP_RANGE_CAP=0.72
M1SCALP_DYN_CAP_PF_CUT_MAX=0.75
M1SCALP_DYN_CAP_PF_CUT_MULT=0.95
M1SCALP_DYN_ALLOC_MIN_TRADES=4
M1SCALP_DYN_ALLOC_LOSER_SCORE=0.55
M1SCALP_ALLOW_REVERSION=0
M1SCALP_ALLOW_TREND=1
IMPULSERETRACE_BASE_UNITS=10000
RANGEFADER_BASE_UNITS=10000
PULSEBREAK_BASE_UNITS=10000
SCALP_MULTI_BASE_UNITS=10000

# Micro base sizes
MICRO_MULTI_BASE_UNITS=42000
MICRO_MULTI_LOOP_INTERVAL_SEC=4.0
MICRO_MULTI_MAX_SIGNALS_PER_CYCLE=2
MICRO_MULTI_MULTI_SIGNAL_MIN_SCALE=0.45
MICRO_MULTI_MAX_FACTOR_AGE_SEC=600
MICRO_MULTI_DYN_CAP_RANGE_CAP=0.78
MICRO_MULTI_DYN_CAP_PF_CUT_MAX=0.80
MICRO_MULTI_DYN_CAP_PF_CUT_MULT=0.95
BBRSI_BASE_UNITS=30000

# --- Margin relief: unwind deadlocked hedge books quickly under margin stress ---
MARGIN_RELIEF_TRIGGER_MARGIN_USAGE=0.84
MARGIN_RELIEF_TRIGGER_FREE_MARGIN_RATIO=0.14
MARGIN_RELIEF_RELEASE_MARGIN_USAGE=0.78
MARGIN_RELIEF_RELEASE_FREE_MARGIN_RATIO=0.20
MARGIN_RELIEF_BIAS_THRESHOLD=0.00
MARGIN_RELIEF_MIN_GROSS_UNITS=12000
MARGIN_RELIEF_MIN_NET_UNITS=0
MARGIN_RELIEF_MIN_HOLD_SEC=300
MARGIN_RELIEF_RANGE_MIN_HOLD_SEC=180
MARGIN_RELIEF_TECH_EXIT_REQUIRED=0
MARGIN_RELIEF_TECH_EXIT_MIN_HOLD_SEC=180
MARGIN_RELIEF_LOSS_TRIGGER_PIPS=0.2
MARGIN_RELIEF_RANGE_LOSS_TRIGGER_PIPS=0.15
MARGIN_RELIEF_PARTIAL_FRACTION=0.45
MARGIN_RELIEF_RANGE_PARTIAL_FRACTION=0.55
MARGIN_RELIEF_EXIT_COOLDOWN_SEC=12
MARGIN_RELIEF_EXIT_MAX_ACTIONS=3

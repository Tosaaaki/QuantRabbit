gcp_location = "asia-northeast1"
gcp_project_id = "your-project-id"
gcp_pubsub_topic = "quant-topic"
ui_bucket_name = "fx-ui-realtime"
ui_state_object_path = "realtime/ui_state.json"
ui_service_account_email = "ui-dashboard-sa@quantrabbit.iam.gserviceaccount.com"
AUTOTUNE_BQ_TABLE = "quantrabbit.autotune_runs"
AUTOTUNE_BQ_SETTINGS_TABLE = "quantrabbit.autotune_settings"

oanda_account_id = "000-000-00000000-000"
oanda_token = "replace-with-your-token"
oanda_practice = "true"
oanda_hedging_enabled = "true"  # allow offsetting long/short positions

openai_api_key = "sk-test-placeholder"
openai_model = "gpt-4o-mini"
openai_model_decider = "gpt-5-mini"
openai_model_summarizer = "gpt-4o-mini"
openai_max_month_tokens = "300000"
tradingeconomics_api_key = "client:secret"  # format: <client>:<secret>

# LLM provider (Vertex-only recommended)
LLM_PROVIDER = "vertex"               # openai|vertex
GPT_DECIDER_PROVIDER = "vertex"       # override per decider
GPT_SUMMARIZER_PROVIDER = "vertex"    # override per summarizer
LLM_IN_MAIN_ENABLED = "0"             # 1: main loop uses LLM (decider/advisors)
VERTEX_PROJECT_ID = "your-project-id" # optional (ADC default if omitted)
VERTEX_DECIDER_MODEL = "gemini-2.0-flash"
VERTEX_SUMMARIZER_MODEL = "gemini-2.0-flash"
VERTEX_OPTIMIZER_MODEL = "gemini-2.0-flash"
VERTEX_DECIDER_TIMEOUT_SEC = "20"
VERTEX_SUMMARIZER_TIMEOUT_SEC = "20"
VERTEX_OPTIMIZER_TIMEOUT_SEC = "20"
LLM_OPS_POLICY_PROVIDER = "vertex"    # ops policy generator (vertex|openai)
LLM_OPS_POLICY_MODEL = "gemini-2.0-flash"
LLM_OPS_POLICY_TIMEOUT_SEC = "20"
LLM_OPS_POLICY_MAX_TOKENS = "900"
LLM_OPS_POLICY_HOURS = "6"
LLM_OPS_POLICY_APPLY = "0"            # 1: apply ops policy diff to overlay
LLM_OPS_POLICY_EXCLUDE_PERF = "0"     # 1: exclude performance metrics from ops policy input
GPT_STRICT_REQUIRED = "0"             # 1: GPT失敗でエントリー停止
GPT_DECIDER_BLOCKING = "0"            # 1: GPT応答を待つ（メインループをブロック）
GPT_DECIDER_WAIT_TIMEOUT_SEC = "8"

# Entry/exit routing
SIGNAL_GATE_ENABLED = "0"            # 1: main gate ranks worker signals
ORDER_FORWARD_TO_SIGNAL_GATE = "0"   # 1: workers enqueue to gate instead of direct orders
EXIT_MANAGER_DISABLED = "1"          # 0: enable legacy ExitManager (not recommended)

# BigQuery (Looker Studio / 集計用)
BQ_PROJECT = "your-project-id"          # 省略時は GOOGLE_CLOUD_PROJECT を使用
BQ_DATASET = "quantrabbit"              # bq_exporter の既定に合わせる
BQ_TRADES_TABLE = "trades_raw"          # bq_exporter の既定
BQ_LOCATION = "asia-northeast1"
# BigQuery (ops insights / 監視・品質)
BQ_EXECUTION_QUALITY_TABLE = "execution_quality"
BQ_MARKET_STATE_TABLE = "market_state"
BQ_EXPOSURE_TABLE = "exposure_snapshot"
BQ_OPS_HEALTH_TABLE = "ops_health"
BQ_OPS_INSIGHTS_LOOKBACK_MIN = "120"
BQ_OPS_INSIGHTS_RETENTION_H = "168"
BQ_ORDERS_DB = "logs/orders.db"
BQ_METRICS_DB = "logs/metrics.db"
OPS_HEALTH_SNAPSHOT_PATH = "logs/health_snapshot.json"
OPS_EXPOSURE_INSTRUMENT = "USD_JPY"
OPS_EXEC_QUALITY_ENABLED = "1"
OPS_MARKET_STATE_ENABLED = "1"
OPS_EXPOSURE_ENABLED = "1"
OPS_HEALTH_ENABLED = "1"

# Firestore (strategy score snapshot)
FIRESTORE_PROJECT = "your-project-id"   # 省略時は BQ_PROJECT / GCP_PROJECT を利用
FIRESTORE_COLLECTION = "strategy_scores"
FIRESTORE_DOCUMENT = "current"
FIRESTORE_STRATEGY_ENABLE = "false"     # VM 側で Firestore 戦略スコアを読む場合のみ true
FIRESTORE_STRATEGY_TTL_SEC = "60"       # VM 読み取りキャッシュ TTL（秒）
FIRESTORE_STRATEGY_APPLY_SLTP = "false" # SL/TP 推奨値を適用するなら true（初期は無効）

# Level map (price buckets / reversal map)
LEVEL_MAP_ENABLE = "false"              # level_map.json を読む場合のみ true（初期は無効）
LEVEL_MAP_TTL_SEC = "300"
LEVEL_MAP_OBJECT_PATH = "analytics/level_map.json"

# Policy loop (Vertex AI)
POLICY_OVERLAY_PATH = "logs/policy_overlay.json"
POLICY_HISTORY_DIR = "logs/policy_history"
POLICY_LATEST_PATH = "logs/policy_latest.json"
POLICY_REFRESH_SEC = "5"
POLICY_TIMEZONE = "Asia/Tokyo"
POLICY_VOL_BUCKETS = "2,4,6"
BQ_POLICY_TABLE = "policy_history"
POLICY_GCS_PREFIX = "policy"
VERTEX_LOCATION = "us-central1"
VERTEX_POLICY_MODEL = "gemini-2.0-flash"
POLICY_SHADOW_MODEL = "gpt-5-mini"
SIGNAL_GATE_POLICY_ENABLED = "0"      # 1: policy overlay filters worker signals at gate
POLICY_HEURISTIC_PERF_BLOCK_ENABLED = "1"  # 0: disable heuristic perf-based auto-block
POLICY_RULES_ENABLED = "1"            # 1: enable non-perf policy rules (range/spread/trend)
POLICY_TREND_STRENGTH_MIN = "1.0"     # H4 trend strength threshold (net/avg_range)
POLICY_TREND_STRENGTH_MIN_H1 = "1.0"  # H1 trend strength threshold (net/avg_range)
POLICY_SPREAD_P95_PIPS = "1.4"        # scalp soft throttle when spread p95 exceeds this
POLICY_BQ_INSIGHTS_ENABLED = "0"      # 1: load BQ ops insights in policy loop
POLICY_BQ_RANGE_ACTIVE_RATIO = "0.6"  # range_active_ratio >= threshold -> range mode
POLICY_BQ_SNAPSHOT_MAX_AGE_MIN = "15" # stale guard for BQ snapshots
POLICY_BQ_EXEC_MIN_ORDERS = "10"      # min orders to trust reject/latency stats
POLICY_BQ_REJECT_RATE_MAX = "0.01"    # reject_rate >= threshold -> entry block
POLICY_BQ_DATA_LAG_P95_MAX = "1500"   # data_lag_ms p95 threshold
POLICY_BQ_LATENCY_P95_MAX = "2000"    # decision_latency_ms p95 threshold
POLICY_BQ_FREE_MARGIN_MIN = "0.08"    # free_margin_ratio below -> entry block
OPS_REPLAY_DIR = "logs/replay/USD_JPY"

# Policy guard (auto rollback)
POLICY_GUARD_LOOKBACK_MIN = "120"
POLICY_GUARD_STABLE_MIN_SEC = "1800"
POLICY_GUARD_STABLE_PATH = "logs/policy_stable.json"
POLICY_GUARD_METRICS_DB = "logs/metrics.db"
POLICY_GUARD_ORDERS_DB = "logs/orders.db"
POLICY_GUARD_MAX_DECISION_MS = "2000"
POLICY_GUARD_MAX_DATA_LAG_MS = "1500"
POLICY_GUARD_MAX_DRAWDOWN_PCT = "0.18"
POLICY_GUARD_MIN_ORDER_SUCCESS = "0.995"
POLICY_GUARD_MAX_REJECT_RATE = "0.01"
POLICY_GUARD_MAX_GPT_TIMEOUT = "0.05"
POLICY_GUARD_REJECT_STREAK = "3"
POLICY_SHADOW_ENABLED = "false"

# --- Risk & sizing ---
# 1 トレードあたりの許容リスク割合（equity 比）。例: 0.01 = 1%
risk_pct = "0.025"
# マルチポケット合流時の最大リスク割合（base〜max で自動調整）
risk_pct_max = "0.1"
# 使用可能証拠金に対する最大使用割合（0.0〜1.0）
max_margin_usage = "0.92"
# Pocket allocation (total lot share)
POCKET_SCALP_SHARE = "0.30"
POCKET_MIN_MICRO_WEIGHT = "0.05"
POCKET_MIN_SCALP_WEIGHT = "0.10"
POCKET_MIN_MACRO_WEIGHT = "0.70"
SCALP_TACTICAL = "0"
# Pocketごとの最小ロット/units（SL無し運用時のスキップ防止用）
RISK_MIN_LOT_SCALP = "0.10"          # 10k units
ORDER_MIN_UNITS_SCALP = "10000"
ORDER_MIN_UNITS_MACRO = "2000"
ORDER_MIN_UNITS_MICRO = "1000"
# --- Entry RR guard (TP>=SL) ---
ORDER_MIN_RR_ENABLED = "1"
ORDER_MIN_RR_MACRO = "1.5"
ORDER_MIN_RR_MICRO = "1.35"
ORDER_MIN_RR_SCALP = "1.2"
ORDER_MIN_RR_SCALP_FAST = "1.15"
ORDER_MIN_RR_MANUAL = "1.0"
ORDER_MIN_RR_ADJUST_MODE = "tp"
# Scalp worker minimums (override defaults as needed)
M1SCALP_MIN_UNITS = "1000"
SCALP_MULTI_MIN_UNITS = "1000"
M1SCALP_BASE_UNITS = "6000"
SCALP_MULTI_BASE_UNITS = "6000"
M1SCALP_MAX_SPREAD_PIPS = "1.4"
M1SCALP_BLOCK_HOURS_ENABLED = "0"
M1SCALP_BLOCK_HOURS_UTC = ""
# Session/time bias toggles (default off)
M1SCALP_SESSION_BIAS_ENABLED = "0"
MA_CROSS_SESSION_BIAS_ENABLED = "0"
# Tick-oriented worker loops (sub-second)
FAST_SCALP_LOOP_INTERVAL_SEC = "0.25"
PULLBACK_SCALP_LOOP_INTERVAL_SEC = "0.30"
MIRROR_SPIKE_S5_LOOP_INTERVAL_SEC = "0.45"
IMPULSE_MOMENTUM_S5_LOOP_INTERVAL_SEC = "0.40"
SQUEEZE_BREAK_S5_LOOP_INTERVAL_SEC = "0.45"
VWAP_MAGNET_S5_LOOP_INTERVAL_SEC = "0.45"
PULLBACK_S5_LOOP_INTERVAL_SEC = "0.45"
PULLBACK_RUNNER_S5_LOOP_INTERVAL_SEC = "0.45"
IMPULSE_BREAK_S5_LOOP_INTERVAL_SEC = "0.45"
IMPULSE_RETEST_S5_LOOP_INTERVAL_SEC = "0.50"
MIRROR_SPIKE_TIGHT_LOOP_INTERVAL_SEC = "0.50"
# Aggressive mode: 1 でレンジ抑制と micro ゲート/クールダウン解除
AGGRESSIVE_TRADING = "1"
# Macro汎用フォールバックEXIT無効化（戦略TP/SL優先）
EXIT_DISABLE_MACRO_FALLBACK = "true"
# Pocket別 EXIT ワーカー利用時に main 側の EXIT を無効化するポケット（カンマ区切り）
EXIT_MAIN_DISABLE_POCKETS = ""
EXIT_MAIN_DISABLE_MICRO = "false"
# --- Exit guard (negative close) ---
EXIT_NO_NEGATIVE_CLOSE = "1"
EXIT_TECH_GUARD_ENABLED = "1"
EXIT_TECH_GUARD_FAILOPEN = "0"
EXIT_ALLOW_NEGATIVE_BY_WORKER = "0"
EXIT_ALLOW_NEGATIVE_REASONS = "hard_stop,tech_hard_stop,drawdown,max_drawdown,health_exit,hazard_exit,margin_health,free_margin_low,margin_usage_high"
EXIT_ALLOW_NEGATIVE_NEAR_BE_PIPS = "0.6"
EXIT_ALLOW_NEGATIVE_NEAR_BE_REASONS = "lock_floor,trail_lock,profit_lock,trail_backoff,lock_trail,near_be"
EXIT_HOLD_UNTIL_PROFIT_ENABLED = "1"
EXIT_HOLD_UNTIL_PROFIT_CLIENT_IDS = ""
EXIT_HOLD_UNTIL_PROFIT_TRADE_IDS = ""
EXIT_HOLD_UNTIL_PROFIT_MIN_PIPS = "0.0"
EXIT_HOLD_UNTIL_PROFIT_STRICT = "0"
EXIT_COMPOSITE_MIN_SCORE = "4"
TECH_EXIT_STRICT = "1"
TECH_EXIT_REQUIRE_COVERAGE = "1"
TECH_EXIT_REQUIRE_MTF_TRIAD = "1"
TECH_EXIT_REQUIRE_FIB = "1"
TECH_EXIT_REQUIRE_MEDIAN = "1"
TECH_EXIT_REQUIRE_NWAVE = "1"
TECH_EXIT_REQUIRE_CANDLE = "1"
TECH_EXIT_PIVOT_FAILOPEN = "0"
TECH_EXIT_MOMENTUM_FAILOPEN = "0"
TECH_EXIT_MIN_COVERAGE = "0.85"
TECH_EXIT_MOMENTUM_MIN_SCORE_SCALP = "0.42"
TECH_EXIT_MOMENTUM_MIN_SCORE_MICRO = "0.45"
TECH_EXIT_MOMENTUM_MIN_SCORE_MACRO = "0.40"
TECH_EXIT_MOMENTUM_BYPASS_M1SCALPER = "0"
TECH_EXIT_PIVOT_MIN_PIPS_SCALP = "1.2"
TECH_EXIT_PIVOT_MIN_PIPS_MICRO = "2.0"
TECH_EXIT_PIVOT_MIN_PIPS_MACRO = "3.5"
# --- TP cap (momentum adaptive) ---
ORDER_TP_CAP_ENABLED = "1"
ORDER_TP_CAP_DYNAMIC_ENABLED = "1"
ORDER_TP_CAP_SCALP = "10.0"
ORDER_TP_CAP_SCALP_FAST = "5.0"
ORDER_TP_CAP_MICRO = "20.0"
ORDER_TP_CAP_MACRO = "40.0"
ORDER_TP_CAP_MANUAL = "0.0"
ORDER_TP_CAP_MULT_MIN = "0.8"
ORDER_TP_CAP_MULT_MAX = "1.6"
ORDER_TP_CAP_WEIGHT_TREND = "0.6"
ORDER_TP_CAP_WEIGHT_VOL = "0.4"
ORDER_TP_CAP_ADX_LOW_SCALP = "18.0"
ORDER_TP_CAP_ADX_HIGH_SCALP = "35.0"
ORDER_TP_CAP_ATR_LOW_SCALP = "6.0"
ORDER_TP_CAP_ATR_HIGH_SCALP = "14.0"
ORDER_TP_CAP_ADX_LOW_MICRO = "16.0"
ORDER_TP_CAP_ADX_HIGH_MICRO = "30.0"
ORDER_TP_CAP_ATR_LOW_MICRO = "8.0"
ORDER_TP_CAP_ATR_HIGH_MICRO = "20.0"
ORDER_TP_CAP_ADX_LOW_MACRO = "18.0"
ORDER_TP_CAP_ADX_HIGH_MACRO = "32.0"
ORDER_TP_CAP_ATR_LOW_MACRO = "12.0"
ORDER_TP_CAP_ATR_HIGH_MACRO = "28.0"
# --- Exit momentum scaling ---
EXIT_MOMENTUM_SCALE_ENABLED = "1"
EXIT_MOMENTUM_SCALE_LOG = "0"
EXIT_MOMENTUM_INVERT_REVERSAL = "1"
EXIT_MOMENTUM_MULT_MIN = "1.0"
EXIT_MOMENTUM_MULT_MAX = "1.6"
EXIT_MOMENTUM_WEIGHT_TREND = "0.6"
EXIT_MOMENTUM_WEIGHT_VOL = "0.4"
EXIT_MOMENTUM_RANGE_MULT = "1.0"
EXIT_MOMENTUM_TF_SCALP = "M1"
EXIT_MOMENTUM_TF_SCALP_FAST = "M1"
EXIT_MOMENTUM_TF_MICRO = "M5"
EXIT_MOMENTUM_TF_MACRO = "H1"
EXIT_MOMENTUM_ADX_LOW_SCALP = "18.0"
EXIT_MOMENTUM_ADX_HIGH_SCALP = "35.0"
EXIT_MOMENTUM_ATR_LOW_SCALP = "6.0"
EXIT_MOMENTUM_ATR_HIGH_SCALP = "14.0"
EXIT_MOMENTUM_ADX_LOW_MICRO = "16.0"
EXIT_MOMENTUM_ADX_HIGH_MICRO = "30.0"
EXIT_MOMENTUM_ATR_LOW_MICRO = "8.0"
EXIT_MOMENTUM_ATR_HIGH_MICRO = "20.0"
EXIT_MOMENTUM_ADX_LOW_MACRO = "18.0"
EXIT_MOMENTUM_ADX_HIGH_MACRO = "32.0"
EXIT_MOMENTUM_ATR_LOW_MACRO = "12.0"
EXIT_MOMENTUM_ATR_HIGH_MACRO = "28.0"
# Fast-cut (time-stop/MAE) guard in section-axis exits
SECTION_EXIT_FAST_CUT_ENABLED = "true"
# 全ポケットの取引一時停止（1 で停止、0で再開）
TRADING_PAUSED = "0"
# Fast scalp worker (disable to avoid non-exit closes)
FAST_SCALP_ENABLED = "0"
# Macro H1Momentum worker
H1M_ENABLED = "0"
# H1Momentum candlestick entry guard (H1)
H1M_CANDLE_GUARD_ENABLED = "1"
H1M_CANDLE_DIR_REQUIRED = "1"
H1M_CANDLE_DIR_MIN_BODY_PIPS = "2.0"
H1M_CANDLE_MAX_RANGE_PIPS = "90.0"
# H1Momentum multi-timeframe guard (H4 alignment + D1 veto)
H1M_MTF_ENABLED = "1"
H1M_MTF_H4_REQUIRED = "1"
H1M_MTF_H4_MIN_GAP_PIPS = "1.6"
H1M_MTF_D1_VETO = "1"
H1M_MTF_D1_MIN_GAP_PIPS = "3.5"
H1M_MTF_D1_MIN_ADX = "20.0"
# H1Momentum exit guards (H1 candle + MTF)
H1MOMENTUM_EXIT_MTF_ENABLED = "1"
H1MOMENTUM_EXIT_CANDLE_ENABLED = "1"
H1MOMENTUM_EXIT_CANDLE_MIN_BODY_PIPS = "6.0"
H1MOMENTUM_EXIT_CANDLE_MIN_RANGE_PIPS = "30.0"
H1MOMENTUM_EXIT_CANDLE_MIN_BODY_RATIO = "0.45"
# Legacy manual swing worker (disable to avoid cross-pocket exits)
MANUAL_SWING_ENABLED = "0"

# Performance guard (PF/勝率の悪化でブロック)
PERF_GUARD_GLOBAL_ENABLED = "1"
PERF_GUARD_ENABLED = "1"
PERF_GUARD_MODE = "block"
PERF_GUARD_LOOKBACK_DAYS = "14"
PERF_GUARD_MIN_TRADES = "10"
PERF_GUARD_PF_MIN = "0.9"
PERF_GUARD_WIN_MIN = "0.48"
PERF_GUARD_PF_MIN_SCALP = "0.9"
PERF_GUARD_PF_MIN_MICRO = "0.9"
PERF_GUARD_PF_MIN_MACRO = "0.9"
PERF_GUARD_WIN_MIN_SCALP = "0.48"
PERF_GUARD_WIN_MIN_MICRO = "0.48"
PERF_GUARD_WIN_MIN_MACRO = "0.48"
PERF_GUARD_TTL_SEC = "120"
PERF_GUARD_HOURLY = "0"
PERF_GUARD_HOURLY_MIN_TRADES = "12"
PERF_GUARD_RELAX_TAGS = "M1Scalper,ImpulseRetrace"
POCKET_PERF_GUARD_ENABLED = "0"
POCKET_PERF_GUARD_LOOKBACK_DAYS = "7"
POCKET_PERF_GUARD_MIN_TRADES = "60"
POCKET_PERF_GUARD_PF_MIN = "0.95"
POCKET_PERF_GUARD_WIN_MIN = "0.50"
POCKET_PERF_GUARD_PF_MIN_MICRO = "0.92"
POCKET_PERF_GUARD_WIN_MIN_MICRO = "0.48"
POCKET_PERF_GUARD_TTL_SEC = "180"

# Profit giveback guard (recent peak -> drawdown lock)
PROFIT_GUARD_ENABLED = "1"
PROFIT_GUARD_MODE = "block"
PROFIT_GUARD_POCKETS = "scalp"
PROFIT_GUARD_LOOKBACK_MIN = "180"
PROFIT_GUARD_MIN_PEAK_PIPS = "6"
PROFIT_GUARD_MAX_GIVEBACK_PIPS = "3"
PROFIT_GUARD_MIN_PEAK_JPY = "0"
PROFIT_GUARD_MAX_GIVEBACK_JPY = "0"
PROFIT_GUARD_TTL_SEC = "30"

# Spread guard settings
spread_guard_max_pips = "1.4"
spread_guard_release_pips = "1.1"
spread_guard_window_sec = "4.5"
spread_guard_cooldown_sec = "25"
spread_guard_min_high_samples = "3"
spread_guard_release_samples = "4"
spread_guard_max_age_ms = "4000"
spread_guard_baseline_window_sec = "300"
spread_guard_baseline_min_samples = "60"
FAST_SCALP_OFF_HOURS_ENABLED = "0"
FAST_SCALP_SESSION_BIAS_ENABLED = "0"

# Data lag watchdog (tick遅延が続く場合に main を再起動)
DATA_LAG_RESTART_MS = "8000"
DATA_LAG_RESTART_STRIKES = "3"

# Tick stream idle reconnect guard
TICK_STREAM_MAX_IDLE_SEC = "10"
TICK_STREAM_MAX_IDLE_STRIKES = "2"

# Tick silence watchdog (no tick for N seconds -> restart)
TICK_SILENCE_RESTART_SEC = "20"
TICK_SILENCE_RESTART_STRIKES = "3"
TICK_SILENCE_GRACE_SEC = "120"

# Position manager (open trades cache)
POSITION_MANAGER_OPEN_TRADES_CACHE_TTL = "5.0"

# Worker autcontrol (logic loop 内で systemctl を叩く場合のみ 1)
WORKER_AUTOCONTROL_IN_LOGIC = "0"

# Health snapshot (GCS object path)
HEALTH_OBJECT_PATH = "realtime/health_fx-trader-vm.json"

[macro_state]
snapshot_path = "fixtures/macro_snapshots/latest.json"
deadzone = "0.25"
gate_enabled = "false"

[event_window]
enabled = "true"
hours_before = "2"
hours_after = "1"
risk_multiplier = "0.3"

[exposure]
usd_long_max_lot = "2.5"
